frota_2019_01 <- read_excel("1_raw_data/2_vehicle_fleet/2019-01-d_frota_por_uf_municipio_combustivel_janeito_2019.xlsx") %>%
mutate(month = 1,
year = 2019,
date = make_date(2019,1,1))
# Function to rename columns
rename_columns <- function(data) {
# Rename columns and return the modified data frame
data <- data %>%
rename(UF    = 1,
city  = 2,
fuel  = 3,
total = 4,
month = 5,
year  = 6,
date = 7)
return(data) # Ensure the renamed data frame is returned
}
# Loop through months and rename columns for each data frame
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Get the data frame object dynamically
df <- get(df_name)
# Rename columns using the rename_columns function
df <- rename_columns(df)
# Assign the modified data frame back to its original name
assign(df_name, df, envir = .GlobalEnv)
cat("Renamed columns for:", df_name, "\n")
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
# Loop through months and rename columns for each data frame
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Get the data frame object dynamically
df <- get(df_name)
# Rename columns using the rename_columns function
df <- rename_columns(df)
# Assign the modified data frame back to its original name
assign(df_name, df, envir = .GlobalEnv)
cat("Renamed columns for:", df_name, "\n")
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
# Initialize an empty list to store data frames
df_list <- list()
# Loop through months and dynamically add data frames to the list
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Add the data frame to the list
df_list[[df_name]] <- get(df_name)
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
# Loop through months and dynamically add data frames to the list
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Add the data frame to the list
df_list[[df_name]] <- get(df_name)
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
# Initialize an empty list to store data frames
df_list <- list()
# Loop through months and dynamically add data frames to the list
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Add the data frame to the list
df_list[[df_name]] <- get(df_name)
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
# Compare columns across all data frames in the list using janitor
if (length(df_list) > 1) { # Ensure there are at least two data frames to compare
column_comparison <- janitor::compare_df_cols(!!!df_list)
# Print the comparison result
print(column_comparison)
} else {
cat("Not enough data frames to compare.\n")
}
compare_df_cols(
frota_2019_01,
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
frota_2019_08$total <- as.numeric(frota_2019_08$total)
View(frota_2019_08)
frota_2019_08$total <- as.numeric(frota_2019_08$total)
is.na(frota_2019_08$total) <- 0
View(frota_2019_08)
frota_2019_08 <- frota_2019_08 %>%
as.numeric(total)  %>%
is.na(total) <- 0
frota_2019_08$total <- as.numeric(frota_2019_08$total)
frota_2019_08$total[is.na(frota_2019_08$total)] <- 0
compare_df_cols(
frota_2019_01,
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
# Fixing column type and changing NAs for 0
frota_2019_09$total <- as.numeric(frota_2019_09$total)
frota_2019_09$total[is.na(frota_2019_09$total)] <- 0
frota_2014_all <- frota_2014_01 %>%
bind_rows(
frota_2014_02,
frota_2014_03,
frota_2014_04,
frota_2014_05,
frota_2014_06,
frota_2014_07,
frota_2014_08,
frota_2014_09,
frota_2014_10,
frota_2014_11,
frota_2014_12)
download_and_process_19_xlsx <- function(base_url, months, year) {
month_map <- c("janeito" = 1, "fevereiro" = 2, "marco" = 3, "abril" = 4, "maio" = 5, "junho" = 6,
"julho" = 7, "agosto" = 8, "setembro" = 9, "outubro" = 10, "novembro" = 11, "dezembro" = 12)
all_dataframes <- list()
for (month in months) {
url <- paste0(base_url, year, "/", month, "/d_frota_por_uf_municipio_combustivel_", tolower(month), "_", year, ".xlsx")
temp_file <- tempfile(fileext = ".xlsx")
tryCatch({
download.file(url, temp_file, mode = "wb")
df <- read_excel(temp_file)
df <- df %>%
mutate(month = month_map[month],
year = as.numeric(year),
date = make_date(year, month_map[month], 1))
df_name <- paste0("frota_", year, "_", sprintf("%02d", month_map[month]))
assign(df_name, df, envir = .GlobalEnv)
all_dataframes[[df_name]] <- df
cat("Processed:", df_name, "\n")
}, error = function(e) {
cat("Failed to process:", url, "\nError:", e$message, "\n")
})
unlink(temp_file)
}
}
base_url <- "https://www.gov.br/transportes/pt-br/assuntos/transito/arquivos-senatran/estatisticas/renavam/"
months <- c("dezembro", "novembro", "outubro", "setembro", "agosto", "julho", "junho", "maio", "abril", "marco", "fevereiro", "janeito")
year <- "2019"
download_and_process_19_xlsx(base_url, months, year)
# Typo in the file name; downloaded it manually and imported it
frota_2019_01 <- read_excel("1_raw_data/2_vehicle_fleet/2019-01-d_frota_por_uf_municipio_combustivel_janeito_2019.xlsx") %>%
mutate(month = 1,
year = 2019,
date = make_date(2019,1,1))
# Function to rename columns
rename_columns <- function(data) {
# Rename columns and return the modified data frame
data <- data %>%
rename(UF    = 1,
city  = 2,
fuel  = 3,
total = 4,
month = 5,
year  = 6,
date = 7)
return(data) # Ensure the renamed data frame is returned
}
compare_df_cols(
frota_2019_01,
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
# Fixing column type and changing NAs for 0
frota_2019_08$total <- as.numeric(frota_2019_08$total)
frota_2019_08$total[is.na(frota_2019_08$total)] <- 0
# Fixing column type and changing NAs for 0
frota_2019_09$total <- as.numeric(frota_2019_09$total)
frota_2019_09$total[is.na(frota_2019_09$total)] <- 0
download_and_process_19_xlsx <- function(base_url, months, year) {
month_map <- c("janeito" = 1, "fevereiro" = 2, "marco" = 3, "abril" = 4, "maio" = 5, "junho" = 6,
"julho" = 7, "agosto" = 8, "setembro" = 9, "outubro" = 10, "novembro" = 11, "dezembro" = 12)
all_dataframes <- list()
for (month in months) {
url <- paste0(base_url, year, "/", month, "/d_frota_por_uf_municipio_combustivel_", tolower(month), "_", year, ".xlsx")
temp_file <- tempfile(fileext = ".xlsx")
tryCatch({
download.file(url, temp_file, mode = "wb")
df <- read_excel(temp_file)
df <- df %>%
mutate(month = month_map[month],
year = as.numeric(year),
date = make_date(year, month_map[month], 1))
df_name <- paste0("frota_", year, "_", sprintf("%02d", month_map[month]))
assign(df_name, df, envir = .GlobalEnv)
all_dataframes[[df_name]] <- df
cat("Processed:", df_name, "\n")
}, error = function(e) {
cat("Failed to process:", url, "\nError:", e$message, "\n")
})
unlink(temp_file)
}
}
base_url <- "https://www.gov.br/transportes/pt-br/assuntos/transito/arquivos-senatran/estatisticas/renavam/"
months <- c("dezembro", "novembro", "outubro", "setembro", "agosto", "julho", "junho", "maio", "abril", "marco", "fevereiro", "janeito")
year <- "2019"
download_and_process_19_xlsx(base_url, months, year)
# Typo in the file name; downloaded it manually and imported it
frota_2019_01 <- read_excel("1_raw_data/2_vehicle_fleet/2019-01-d_frota_por_uf_municipio_combustivel_janeito_2019.xlsx") %>%
mutate(month = 1,
year = 2019,
date = make_date(2019,1,1))
# Function to rename columns
rename_columns <- function(data) {
# Rename columns and return the modified data frame
data <- data %>%
rename(UF    = 1,
city  = 2,
fuel  = 3,
total = 4,
month = 5,
year  = 6,
date = 7)
return(data) # Ensure the renamed data frame is returned
}
# Loop through months and rename columns for each data frame
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Get the data frame object dynamically
df <- get(df_name)
# Rename columns using the rename_columns function
df <- rename_columns(df)
# Assign the modified data frame back to its original name
assign(df_name, df, envir = .GlobalEnv)
cat("Renamed columns for:", df_name, "\n")
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
compare_df_cols(
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
# Fixing column type and changing NAs for 0
frota_2019_08$total <- as.numeric(frota_2019_08$total)
frota_2019_08$total[is.na(frota_2019_08$total)] <- 0
frota_2019_08$total <- as.numeric(frota_2019_08$total)
frota_2019_08$total[is.na(frota_2019_08$total)] <- 0
frota_2019_all <- frota_2019_01 %>%
bind_rows(
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
compare_df_cols(
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
frota_2019_09$total <- as.numeric(frota_2019_09$total)
frota_2019_09$total[is.na(frota_2019_09$total)] <- 0
frota_2019_all <- frota_2019_01 %>%
bind_rows(
frota_2019_02,
frota_2019_03,
frota_2019_04,
frota_2019_05,
frota_2019_06,
frota_2019_07,
frota_2019_08,
frota_2019_09,
frota_2019_10,
frota_2019_11,
frota_2019_12)
if (!file.exists("./1_raw_data/2_vehicle_fleet/fleet_2019_fuel.csv")) {
write_csv(frota_2019_all,
file = "./1_raw_data/2_vehicle_fleet/fleet_2019_fuel.csv")
} else {
print("File already exists in the repository")
}
download_and_process_18_xlsx <- function(base_url, months, year) {
month_map <- c("janeiro" = 1, "fevereiro" = 2, "marco" = 3, "abril" = 4, "maio" = 5, "junho" = 6,
"julho" = 7, "agosto" = 8, "setembro" = 9, "outubro" = 10, "novembro" = 11, "dezembro" = 12)
all_dataframes <- list()
for (month in months) {
url <- paste0(base_url, year, "/", month, "/d_frota_por_uf_municipio_combustivel_", tolower(month), "_", year, ".xlsx")
temp_file <- tempfile(fileext = ".xlsx")
tryCatch({
download.file(url, temp_file, mode = "wb")
df <- read_excel(temp_file)
df <- df %>%
mutate(month = month_map[month],
year = as.numeric(year),
date = make_date(year, month_map[month], 1))
df_name <- paste0("frota_", year, "_", sprintf("%02d", month_map[month]))
assign(df_name, df, envir = .GlobalEnv)
all_dataframes[[df_name]] <- df
cat("Processed:", df_name, "\n")
}, error = function(e) {
cat("Failed to process:", url, "\nError:", e$message, "\n")
})
unlink(temp_file)
}
}
base_url <- "https://www.gov.br/transportes/pt-br/assuntos/transito/arquivos-senatran/estatisticas/renavam/"
months <- c("dezembro", "novembro", "outubro", "setembro", "agosto", "julho", "junho", "maio", "abril", "marco", "fevereiro", "janeiro")
year <- "2018"
frota_2018_01 <- read_excel("1_raw_data/2_vehicle_fleet/2018_01_frota_por_uf_municipio_combustivel_jan_18.xlsx") %>%
mutate(month = 1,
year = 2018,
date = make_date(2018,1,1))
frota_2018_02 <- read_excel("1_raw_data/2_vehicle_fleet/2018_02_frota_por_uf_municipio_combustivel_fev_18.xlsx") %>%
mutate(month = 2,
year = 2018,
date = make_date(2018,2,1))
frota_2018_03 <- read_excel("1_raw_data/2_vehicle_fleet/2018_03_frota_por_uf_municipio_combustivel_mar_18.xlsx") %>%
mutate(month = 3,
year = 2018,
date = make_date(2018,3,1))
frota_2018_04 <- read_excel("1_raw_data/2_vehicle_fleet/2018_04_d_frota_por_uf_municipio_combustivel_abr_2018.xlsx") %>%
mutate(month = 4,
year = 2018,
date = make_date(2018,4,1))
frota_2018_05 <- read_excel("1_raw_data/2_vehicle_fleet/2018_05_d_frota_por_uf_municipio_combustivel_mai_2018.xlsx") %>%
mutate(month = 5,
year = 2018,
date = make_date(2018,6,1))
frota_2018_06 <- read_excel("1_raw_data/2_vehicle_fleet/2018_06_d_frota_por_uf_municipio_combustivel_jun_2018.xlsx") %>%
mutate(month = 6,
year = 2018,
date = make_date(2018,6,1))
download_and_process_18_xlsx(base_url, months, year)
compare_df_cols(
paste("frota_", year, "_01", sep = ""),
paste("frota_", year, "_02", sep = ""),
paste("frota_", year, "_03", sep = ""),
paste("frota_", year, "_04", sep = ""),
paste("frota_", year, "_05", sep = ""),
paste("frota_", year, "_06", sep = ""),
paste("frota_", year, "_07", sep = ""),
paste("frota_", year, "_08", sep = ""),
paste("frota_", year, "_09", sep = ""),
paste("frota_", year, "_10", sep = ""),
paste("frota_", year, "_11", sep = ""),
paste("frota_", year, "_12", sep = ""))
paste("frota_", year, "_01", sep = "")
get(paste("frota_", year, "_01", sep = ""))
compare_df_cols(
get(paste("frota_", year, "_01", sep = "")),
get(paste("frota_", year, "_02", sep = "")),
get(paste("frota_", year, "_03", sep = "")),
get(paste("frota_", year, "_04", sep = "")),
get(paste("frota_", year, "_05", sep = "")),
get(paste("frota_", year, "_06", sep = "")),
get(paste("frota_", year, "_07", sep = "")),
get(paste("frota_", year, "_08", sep = "")),
get(paste("frota_", year, "_09", sep = "")),
get(paste("frota_", year, "_10", sep = "")),
get(paste("frota_", year, "_11", sep = "")),
get(paste("frota_", year, "_12", sep = "")))
# Function to rename columns
rename_columns <- function(data) {
# Rename columns and return the modified data frame
data <- data %>%
rename(UF    = 1,
city  = 2,
fuel  = 3,
total = 4,
month = 5,
year  = 6,
date = 7)
return(data) # Ensure the renamed data frame is returned
}
# Loop through months and rename columns for each data frame
for (i in 1:12) {
# Construct the name of the data frame dynamically
if (i < 10) {
df_name <- paste("frota_", year,"_0", i, sep = "") # e.g., "frota_2019_01"
} else {
df_name <- paste("frota_", year,"_", i, sep = "") # e.g., "frota_2019_10"
}
# Check if the object exists in the global environment
if (exists(df_name)) {
# Get the data frame object dynamically
df <- get(df_name)
# Rename columns using the rename_columns function
df <- rename_columns(df)
# Assign the modified data frame back to its original name
assign(df_name, df, envir = .GlobalEnv)
cat("Renamed columns for:", df_name, "\n")
} else {
cat("Data frame does not exist:", df_name, "\n")
}
}
compare_df_cols(
get(paste("frota_", year, "_01", sep = "")),
get(paste("frota_", year, "_02", sep = "")),
get(paste("frota_", year, "_03", sep = "")),
get(paste("frota_", year, "_04", sep = "")),
get(paste("frota_", year, "_05", sep = "")),
get(paste("frota_", year, "_06", sep = "")),
get(paste("frota_", year, "_07", sep = "")),
get(paste("frota_", year, "_08", sep = "")),
get(paste("frota_", year, "_09", sep = "")),
get(paste("frota_", year, "_10", sep = "")),
get(paste("frota_", year, "_11", sep = "")),
get(paste("frota_", year, "_12", sep = "")))
frota_2018_all <- get(paste("frota_", year, "_01", sep = "")) %>%
bind_rows(get(paste("frota_", year, "_02", sep = "")),
get(paste("frota_", year, "_03", sep = "")),
get(paste("frota_", year, "_04", sep = "")),
get(paste("frota_", year, "_05", sep = "")),
get(paste("frota_", year, "_06", sep = "")),
get(paste("frota_", year, "_07", sep = "")),
get(paste("frota_", year, "_08", sep = "")),
get(paste("frota_", year, "_09", sep = "")),
get(paste("frota_", year, "_10", sep = "")),
get(paste("frota_", year, "_11", sep = "")),
get(paste("frota_", year, "_12", sep = "")))
View(frota_2018_all)
if (!file.exists("./1_raw_data/2_vehicle_fleet/fleet_2018_fuel.csv")) {
write_csv(frota_2018_all,
file = "./1_raw_data/2_vehicle_fleet/fleet_2018_fuel.csv")
} else {
print("File already exists in the repository")
}
